---
title: TS使用
date: 2025-09-30 11:30:09
permalink: /pages/f44c05/
categories:
  - 前端
tags:
  - TypeScript
  - TS基础
---
:::tip
掌握了TS的基础概念后，让我们一起来探索如何在各个项目中实际应用它
:::
<!-- more -->

## 常规项目使用TS
### 初始化TS项目
```bash
# 创建项目目录
mkdir my-ts-project
cd my-ts-project

# 初始化npm项目
npm init -y

# 安装TypeScript
npm install -D typescript
npm install -D @types/node

# 初始化tsconfig.json
npx tsc --init
```

### 配置tsconfig.json
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "baseUrl": "./",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### 项目结构示例
```
my-ts-project/
├── src/
│   ├── index.ts
│   ├── utils/
│   │   └── helper.ts
│   └── types/
│       └── user.ts
├── dist/
├── package.json
└── tsconfig.json
```

### 示例代码
src/types/user.ts​

```typescript
export interface User {
  id: number;
  name: string;
  email: string;
  createdAt: Date;
}

export type UserCreateInput = Omit<User, 'id' | 'createdAt'>;
```

### 添加构建和运行脚本
package.json
```json
{
  "scripts": {
    "build": "tsc",
    "start": "node dist/index.js",
    "dev": "tsc && node dist/index.js",
    "watch": "tsc -w"
  }
}
```

## Vue项目使用TS
### 创建Vue + TypeScript项目
```bash
# 使用Vue CLI创建项目
vue create my-vue-ts-app

# 选择Manually select features
# 勾选: TypeScript, Babel, Router, Vuex, CSS Pre-processors
# 选择其他你需要的特性
```
### Vue组件中的TypeScript用法
​src/components/UserCard.vue​
```html
<template>
  <div class="user-card">
    <h3>{{ user.name }}</h3>
    <p>Email: {{ user.email }}</p>
    <p>注册时间: {{ formattedDate }}</p>
    <button @click="handleClick">点击我</button>
  </div>
</template>

<script lang="ts">
import { defineComponent, PropType, computed } from 'vue';
import { User } from '@/types/user';

export default defineComponent({
  name: 'UserCard',
  props: {
    user: {
      type: Object as PropType<User>,
      required: true
    }
  },
  emits: ['user-click'],
  setup(props, { emit }) {
    const formattedDate = computed(() => {
      return props.user.createdAt.toLocaleDateString('zh-CN');
    });

    const handleClick = () => {
      emit('user-click', props.user.id);
    };

    return {
      formattedDate,
      handleClick
    };
  }
});
</script>

<style scoped>
.user-card {
  border: 1px solid #ddd;
  padding: 1rem;
  margin: 1rem 0;
}
</style>
```
### Vuex Store中的TypeScript
​src/store/index.ts​

```typescript
import { createStore } from 'vuex';
import { User } from '@/types/user';

export interface State {
  users: User[];
  currentUser: User | null;
}

export default createStore<State>({
  state: {
    users: [],
    currentUser: null
  },
  mutations: {
    SET_USERS(state, users: User[]) {
      state.users = users;
    },
    SET_CURRENT_USER(state, user: User) {
      state.currentUser = user;
    },
    ADD_USER(state, user: User) {
      state.users.push(user);
    }
  },
  actions: {
    async fetchUsers({ commit }) {
      // 模拟API调用
      const users: User[] = await fetch('/api/users').then(res => res.json());
      commit('SET_USERS', users);
    },
    async addUser({ commit }, userData: Omit<User, 'id' | 'createdAt'>) {
      const newUser: User = {
        ...userData,
        id: Date.now(),
        createdAt: new Date()
      };
      commit('ADD_USER', newUser);
      return newUser;
    }
  },
  getters: {
    getUserById: (state) => (id: number) => {
      return state.users.find(user => user.id === id);
    },
    totalUsers: (state) => state.users.length
  }
});
```

## React项目中使用TypeScript

### 创建React + TypeScript项目
```bash
# 使用Create React App创建TypeScript项目
npx create-react-app my-react-ts-app --template typescript

# 或者使用Vite（推荐，更轻量快速）
npm create vite@latest my-react-ts-app -- --template react-ts

cd my-react-ts-app
npm install
```
### React组件中的TypeScript用法
​src/types/user.ts​

```typescript
export interface User {
  id: number;
  name: string;
  email: string;
  avatar?: string;
  createdAt: Date;
}

export type UserCreateInput = Omit<User, 'id' | 'createdAt'>;
​src/components/UserCard.tsx​
```
```tsx
import React from 'react';
import { User } from '../types/user';

interface UserCardProps {
  user: User;
  onUserClick: (userId: number) => void;
  isSelected?: boolean;
}

const UserCard: React.FC<UserCardProps> = ({ 
  user, 
  onUserClick, 
  isSelected = false 
}) => {
  const handleClick = () => {
    onUserClick(user.id);
  };

  return (
    <div 
      className={`user-card ${isSelected ? 'selected' : ''}`}
      onClick={handleClick}
    >
      <div className="user-avatar">
        {user.avatar ? (
          
        ) : (
          <div className="avatar-placeholder">
            {user.name.charAt(0).toUpperCase()}
          </div>
        )}
      </div>
      <div className="user-info">
        <h3>{user.name}</h3>
        <p>{user.email}</p>
        <small>注册时间: {user.createdAt.toLocaleDateString('zh-CN')}</small>
      </div>
    </div>
  );
};

export default UserCard;
```

### React Hooks与TypeScript
​src/hooks/useUsers.ts​

```typescript
import { useState, useEffect } from 'react';
import { User, UserCreateInput } from '../types/user';

export const useUsers = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    fetchUsers();
  }, []);

  const fetchUsers = async (): Promise<void> => {
    try {
      setLoading(true);
      // 模拟API调用
      const response = await fetch('/api/users');
      const data: User[] = await response.json();
      setUsers(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : '未知错误');
    } finally {
      setLoading(false);
    }
  };

  const addUser = async (userData: UserCreateInput): Promise<User> => {
    try {
      const response = await fetch('/api/users', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(userData),
      });
      
      const newUser: User = await response.json();
      setUsers(prev => [...prev, newUser]);
      return newUser;
    } catch (err) {
      throw new Error(err instanceof Error ? err.message : '添加用户失败');
    }
  };

  return {
    users,
    loading,
    error,
    fetchUsers,
    addUser,
  };
};
```

### 自定义Hook与泛型
​src/hooks/useLocalStorage.ts​

```typescript
import { useState, useEffect } from 'react';

export function useLocalStorage<T>(
  key: string, 
  initialValue: T
): [T, (value: T | ((val: T) => T)) => void] {
  const [storedValue, setStoredValue] = useState<T>(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(`Error reading localStorage key "${key}":`, error);
      return initialValue;
    }
  });

  const setValue = (value: T | ((val: T) => T)) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(`Error setting localStorage key "${key}":`, error);
    }
  };

  useEffect(() => {
    const handleStorageChange = (e: StorageEvent) => {
      if (e.key === key && e.newValue) {
        setStoredValue(JSON.parse(e.newValue));
      }
    };

    window.addEventListener('storage', handleStorageChange);
    return () => window.removeEventListener('storage', handleStorageChange);
  }, [key]);

  return [storedValue, setValue];
}
```

### Redux Toolkit与TypeScript
​src/store/userSlice.ts​

```typescript
import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';
import { User, UserCreateInput } from '../types/user';

interface UserState {
  users: User[];
  currentUser: User | null;
  loading: boolean;
  error: string | null;
}

const initialState: UserState = {
  users: [],
  currentUser: null,
  loading: false,
  error: null,
};

export const fetchUsers = createAsyncThunk(
  'users/fetchUsers',
  async (_, { rejectWithValue }) => {
    try {
      const response = await fetch('/api/users');
      return await response.json();
    } catch (error) {
      return rejectWithValue(error instanceof Error ? error.message : '获取用户失败');
    }
  }
);

const userSlice = createSlice({
  name: 'users',
  initialState,
  reducers: {
    setCurrentUser: (state, action: PayloadAction<User | null>) => {
      state.currentUser = action.payload;
    },
    clearError: (state) => {
      state.error = null;
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchUsers.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchUsers.fulfilled, (state, action: PayloadAction<User[]>) => {
        state.loading = false;
        state.users = action.payload;
      })
      .addCase(fetchUsers.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload as string;
      });
  },
});

export const { setCurrentUser, clearError } = userSlice.actions;
export default userSlice.reducer;
```

## 现有JavaScript项目迁移到TypeScript
### 渐进式迁移策略
步骤1：添加TypeScript依赖
```bash
npm install -D typescript
npm install -D @types/node # 如果是Node项目
npm install -D @types/react @types/react-dom # React项目
```

步骤2：创建tsconfig.json
根据项目类型选择合适的配置：

​React项目tsconfig.json​

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["DOM", "DOM.Iterable", "ES6"],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"]
}
```

## 快捷工具和开发技巧
### React TypeScript快捷工具
​VSCode代码片段​

```json
{
  "React TS Function Component": {
    "prefix": "rtsfc",
    "body": [
      "import React from 'react';",
      "",
      "interface ${1:ComponentName}Props {",
      "  ${2:propName}: ${3:string};",
      "}",
      "",
      "const ${1:ComponentName}: React.FC<${1:ComponentName}Props> = ({ ${2:propName} }) => {",
      "  return (",
      "    <div>",
      "      {${2:propName}}",
      "    </div>",
      "  );",
      "};",
      "",
      "export default ${1:ComponentName};"
    ]
  }
}
```

### 实用工具类型扩展
​src/types/utils.ts​

```typescript
import { ReactNode } from 'react';

// React相关工具类型
export type FCProps<T> = T extends React.FC<infer P> ? P : never;
export type ComponentProps<T> = T extends React.ComponentType<infer P> ? P : never;

// 表单相关
export type FormValues<T extends string> = Record<T, string>;
export type FormErrors<T extends string> = Partial<Record<T, string>>;

// 事件处理
export type ChangeHandler = React.ChangeEventHandler<HTMLInputElement>;
export type ClickHandler = React.MouseEventHandler<HTMLButtonElement>;
```
## 常见问题解决
### React事件类型处理
```tsx
const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  setValue(e.target.value);
};

const handleFormSubmit = (e: React.FormEvent<HTMLFormElement>) => {
  e.preventDefault();
  // 处理提交逻辑
};

const handleKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {
  if (e.key === 'Enter') {
    // 处理回车键
  }
};
```

### 条件渲染类型保护
```tsx
interface UserProfile {
  user: User | null;
  loading: boolean;
}

const UserProfile: React.FC<UserProfile> = ({ user, loading }) => {
  if (loading) {
    return <div>加载中...</div>;
  }

  if (!user) {
    return <div>用户不存在</div>;
  }

  // 这里TypeScript知道user肯定有值
  return (
    <div>
      <h1>{user.name}</h1>
      <p>{user.email}</p>
    </div>
  );
};
```

## 总结
无论是React、Vue还是普通Node.js项目，TypeScript都能提供强大的类型支持和开发体验提升。关键点包括：

  * ​项目配置​：根据项目类型选择合适的tsconfig配置。
  * 组件类型​：正确定义Props和State的类型。
  * Hooks类型​：为自定义Hook添加泛型支持。
  * 事件处理​：正确使用React事件类型。
  * 状态管理​：为Redux或Context提供完整的类型支持。

​相关工具推荐：​​
- React TypeScript Cheatsheet- React TS开发指南
- TypeScript ESLint- TypeScript代码检查
- Redux Toolkit- 类型安全的Redux



