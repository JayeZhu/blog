---
title: vue组件通信
date: 2021-06-11 11:33:12
permalink: /pages/4483d6/
categories:
  - 前端
tags:
  - vue
---
## 前言
vue 提倡单向数据流，目的为了邦正数据流向的简洁性。但开发中会用遇到父子通信的场景。

## props 和 $emit
props 实现父向子传值，$emit 实现子向父传值

### props
- props 使父向子单向传值，子数据随父组件不断更新
- props 可定义多个数据，并且可以定义数据类型和指定默认值
- props 采用驼峰，使用时采用短横线的形式

父组件 Parent
```vue
<template>
  <div>
    <child :msg="message"></child>
  </div>
</template>

<script>
import Child from './Child';

export default {
  name: 'parent',
  components: { Child },
  data: () => ({
    message: '父组件信息',
  }),
};
</script>
```
子组件
```vue
<template>
  <div>子组件接收：{{ msg }}</div>
</template>

<script>
  export default {
    name: "child",
    props: {
      receiveMsg: {
        type: String,
        default: '父组件消息'
      }
    }
  };
</script>
```

### $emit
$emit 结合 events 中的 $on 进行子向父通信

> 不同于组件和 prop，事件名不会被用作一个 JavaScript 变量名或 property 名，所以就没有理由使用 camelCase 或 PascalCase 了。并且 v-on 事件监听器在 DOM 模板中会被自动转换为全小写 (因为 HTML 是大小写不敏感的)，所以 v-on:myEvent 将会变成 v-on:myevent——导致 myEvent 不可能被监听到。

> 因此，我们推荐你始终使用 kebab-case 的事件名。

子组件
```vue
<template>
  <button @click="clickHandle">点击</button>
</template>

<script>
  export default {
    name: "child",
    methods: {
      clickHandle() {
        this.$emit("child-click", "子组件数据");
      }
    }
  };
</script>
```
父组件
```vue
<template>
  <div>
    <div>这是父组件，接收：{{ message }}</div>
    <child @child-click="getChildData"></child>
  </div>
</template>

<script>
  import Child from "./Child";

  export default {
    name: "parent",
    components: {
      Child
    },
    data: () => ({
      message: ""
    }),
    methods: {
      getChildData(data) {
        this.message = data;
      }
    }
  };
</script>
```

## v-model
v-model 是用在表单空间挥着组件上创建双向绑定的，本质是 v-bind 和 v-on 的语法糖，在一个组件上是用 v-model，默认回味组件绑定为 value 的 prop 和名为 input 的事件。

父组件
```vue
<template>
  <base-input v-model="input"></base-input>
</template>
<script>
import BaseInput from './BaseInput';

export default {
  components: { BaseInput },
  data() {
    return {
      input: ''
    }
  },
}
</script>
```
子组件
```vue
<template>
  <input type="text" :value="currentValue" @input="handleInput">
</template>

<script>
export default {
  data: () => ({
    currentValue: '',
  }),
  props: {
    value: {
      type: [String, Number],
      default: '',
    },
  },
  methods: {
    handleInput (event) {
      const value = event.target.value;
      this.$emit('input', value);
    }
  }
}
</script>
```

## .sync
vue v1.x 提供了 .sync，v2.0 移除，在 v2.3 迎来全新的 .sync

.sync 和 v-model 类似，也是 v-bind 和 v-on 的语法糖，但是更灵活

父组件
```vue
<template>
  <text-document
    v-bind:title="doc.title"
    v-on:update:title="doc.title = $event"
  ></text-document>
</template>
```
子组件
```js
this.$emit('update:title', newTitle)
```

### v-model 和 .sync
.sync 从功能上看和 v-model 十分相似，都是为了实现数据的“双向绑定”，本质上，也都不是真正的双向绑定，而是语法糖。
相比较之下，.sync 更加灵活，它可以给多个 prop 使用，而 v-model 在一个组件中只能有一个。
从语义上来看，v-model 绑定的值是指这个组件的绑定值，比如 input 组件，select 组件，日期时间选择组件，颜色选择器组件，这些组件所绑定的值使用 v-model 比较合适。其他情况，没有这种语义，个人认为使用 .sync 更好。

## ref 和 refs

## $parent 和 $children

## $attrs 和 $listeners

## provide 和 inject

## eventBus

## $root

## Vuex