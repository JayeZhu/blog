---
title: 十万级数据渲染
date: 2021-07-12 10:34:45
permalink: /pages/5cdeba/
categories:
  - 技术
tags:
  - 项目难点
---
## 项目背景
项目是有关工业互联网的，用来处理和展示工业数据，有时候数据量比较庞大，达到十万级，因此需要作出优化。

## 数据大小
后台返回的数据大小为 10.5 MB，返回时间为 2.97 s，每条数据属性 74 项

## 页面情况
页面卡死，根本无法使用

## 优化
### keep-alive
- include
- exclude
- max
- activated
- reactivated

### 滑动加载
```js
const totalPage = Math.ceil(this.itemsTmp.length / 20);
this.allCurPage = 1;
const dom = document.getElementsByClassName('v-data-table__wrapper')[0];
// 监听元素的滑动事件
const scrollDistance = dom.scrollHeight - dom.scrollTop - dom.clientHeight;
// 距离底部只有 10px 时触发下滑更新
if (scrollDistance <= 10) {
  if (this.allCurPage < totalPage) {
    this.allCurPage++;
    this.items = [...this.items, ...this.itemsTmp.filter((i, index) => (index >= 20 * (this.allCurPage - 2)) && (index <= 20 * (this.allCurPage - 1)))];
  }
}
```

### 动态表头
- 首先定义了所有表头，放入列表供用户选择
- 用 watch 监听用户的选择，控制能够选择的个数
- 然后用计算属性缓存用户选择的数组列表

### Vuex 存放状态
keep-alive 需要存放，能够在下一次切换到二级菜单时直接去到上一次点击的三级菜单的位置