---
title: Express本地部署
date: 2025-10-16 16:14:27
permalink: /pages/537d62/
categories:
  - 后端
tags:
  - Express
  - Express部署
---
# Express本地部署指南

## 准备工作

### 环境要求
- Node.js (推荐 LTS 版本)
- npm 或 yarn
- Git
- 文本编辑器

### 项目初始化
```bash
# 创建项目目录
mkdir my-express-app
cd my-express-app

# 初始化项目
npm init -y

# 安装Express
npm install express
```

## 基础应用创建

### 创建入口文件
```javascript
// app.js
const express = require('express');
const app = express();
const PORT = process.env.PORT || 3000;

// 基础中间件
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// 基础路由
app.get('/', (req, res) => {
  res.json({ message: 'Hello World!' });
});

// 启动服务器
app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});
```

## 环境配置

### 环境变量设置
```javascript
// config/environment.js
require('dotenv').config();

module.exports = {
  port: process.env.PORT || 3000,
  nodeEnv: process.env.NODE_ENV || 'development',
  database: {
    url: process.env.DATABASE_URL
  }
};
```

### .env 文件
```env
NODE_ENV=development
PORT=3000
DATABASE_URL=mongodb://localhost:27017/myapp
```

## 本地数据库设置

### MongoDB设置
```bash
# 安装MongoDB
sudo apt-get install mongodb

# 启动MongoDB服务
sudo systemctl start mongodb

# 验证安装
mongo --eval 'db.runCommand({ connectionStatus: 1 })'
```

### 数据库连接
```javascript
// config/database.js
const mongoose = require('mongoose');

mongoose.connect(process.env.DATABASE_URL, {
  useNewUrlParser: true,
  useUnifiedTopology: true
});

mongoose.connection.on('connected', () => {
  console.log('Connected to MongoDB');
});

mongoose.connection.on('error', (err) => {
  console.error('MongoDB connection error:', err);
});
```

## 本地开发工具

### Nodemon设置
```bash
# 安装nodemon
npm install --save-dev nodemon

# 配置package.json
"scripts": {
  "start": "node app.js",
  "dev": "nodemon app.js"
}
```

### nodemon.json配置
```json
{
  "watch": ["src", "config"],
  "ext": "js,json",
  "ignore": ["node_modules"],
  "delay": "1000"
}
```

## 项目结构组织

```
my-express-app/
├── src/
│   ├── controllers/
│   ├── models/
│   ├── routes/
│   └── middleware/
├── config/
│   ├── environment.js
│   └── database.js
├── test/
├── public/
├── views/
├── .env
├── .gitignore
├── app.js
└── package.json
```

## 本地测试

### 单元测试设置
```bash
# 安装测试依赖
npm install --save-dev jest supertest

# 配置package.json
"scripts": {
  "test": "jest",
  "test:watch": "jest --watch"
}
```

### 测试示例
```javascript
// test/app.test.js
const request = require('supertest');
const app = require('../app');

describe('App Test', () => {
  it('should return Hello World', async () => {
    const response = await request(app)
      .get('/')
      .expect(200);
    
    expect(response.body.message).toBe('Hello World!');
  });
});
```

## 常见问题解决

### 端口占用
```bash
# 查找占用端口的进程
lsof -i :3000

# 终止进程
kill -9 PID
```

### 依赖问题
```bash
# 清除缓存
npm cache clean --force

# 删除node_modules并重新安装
rm -rf node_modules
npm install
```

## 本地开发最佳实践

1. **版本控制**
```bash
# 初始化Git
git init

# 创建.gitignore
node_modules/
.env
dist/
coverage/
```

2. **代码规范**
```bash
# 安装ESLint
npm install --save-dev eslint

# 配置.eslintrc.js
module.exports = {
  env: {
    node: true,
    es2021: true
  },
  extends: ['eslint:recommended'],
  parserOptions: {
    ecmaVersion: 12
  }
};
```

3. **开发脚本**
```json
"scripts": {
  "start": "node app.js",
  "dev": "nodemon app.js",
  "test": "jest",
  "lint": "eslint .",
  "lint:fix": "eslint . --fix"
}
```

## 部署验证

### 本地测试
```bash
# 启动应用
npm run dev

# 测试API
curl http://localhost:3000
```

### 日志配置
```javascript
// config/logger.js
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple()
  }));
}

module.exports = logger;
```

## 总结

本地部署是Express开发的第一步，通过合理的配置和工具设置，可以：
- 提高开发效率
- 确保代码质量
- 简化调试过程
- 便于后续部署

记住，良好的本地开发环境设置是项目成功的重要基础。