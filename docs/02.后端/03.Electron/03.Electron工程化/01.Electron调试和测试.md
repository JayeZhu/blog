---
title: Electron调试和测试
date: 2025-10-20 14:58:42
permalink: /pages/4edbab/
categories:
  - 后端
tags:
  - Electron
  - Electron工程化
---
Electron 应用包含两种进程：主进程和渲染进程，它们有不同的调试方法。下面将详细介绍如何使用 Chrome DevTools 调试渲染进程，以及使用 Node Inspector 调试主进程的方法。

## 渲染进程调试

渲染进程本质上是浏览器窗口中的 Web 页面，因此可以使用 Chrome DevTools 进行调试：

1. **自动打开 DevTools**（开发环境）：
   ```javascript
   // main.js
   mainWindow = new BrowserWindow({
     webPreferences: {
       devTools: true
     }
   })
   mainWindow.webContents.openDevTools() // 自动打开开发者工具
   ```

2. **手动打开 DevTools**：
   - 在应用窗口中右键点击，选择"检查元素"
   - 或使用快捷键（Windows/Linux: `F12` 或 `Ctrl+Shift+I`，macOS: `Cmd+Option+I`）

3. **加载 DevTools 扩展**：
   可以通过第三方工具 `electron-devtools-installer` 来安装和管理 Chrome DevTools 扩展，如 Vue.js devtools、React Developer Tools 等[citation:3]。也可以手动加载扩展：
   ```javascript
   const { session } = require('electron')
   const path = require('path')
   
   // 加载 Vue DevTools
   const vueDevToolsPath = path.join(
     os.homedir(),
     '/Library/Application Support/Google/Chrome/Default/Extensions/nhdogjmejiglipccpnnnanhbledajbpd/6.5.0_0'
   )
   
   app.whenReady().then(async () => {
     await session.defaultSession.loadExtension(vueDevToolsPath)
   })
   ```

## 主进程调试

主进程是 Node.js 进程，可以使用 Node.js 的调试工具：

1. **使用 VS Code 调试**：
   - 在 `.vscode/launch.json` 中添加配置：
     ```json
     {
       "name": "Debug Main Process",
       "type": "node",
       "request": "launch",
       "cwd": "${workspaceFolder}",
       "runtimeExecutable": "${workspaceFolder}/node_modules/.bin/electron",
       "windows": {
         "runtimeExecutable": "${workspaceFolder}/node_modules/.bin/electron.cmd"
       },
       "args": ["."],
       "outputCapture": "std"
     }
     ```
   - 在 VS Code 中设置断点并启动调试

2. **使用 Chrome DevTools 调试**：
   - 启动应用时添加 `--inspect` 标志：
     ```json
     "scripts": {
       "start": "electron --inspect=5858 ."
     }
     ```
   - 在 Chrome 浏览器中打开 `chrome://inspect`
   - 点击 "Open dedicated DevTools for Node"

3. **使用命令行调试**：
   ```bash
   # 启动应用
   electron --inspect=5858 .
   
   # 使用 Node.js Inspector
   node-inspector
   ```

## 进程间通信调试

Electron 的主进程和渲染进程通过 IPC 通信，调试 IPC 消息：

1. 在渲染进程中：
   ```javascript
   const { ipcRenderer } = require('electron')
   ipcRenderer.send('message', 'data')
   ipcRenderer.on('reply', (event, arg) => {
     console.log('收到回复:', arg)
   })
   ```

2. 在主进程中：
   ```javascript
   const { ipcMain } = require('electron')
   ipcMain.on('message', (event, arg) => {
     console.log('收到消息:', arg)
     event.reply('reply', 'response data')
   })
   ```

## 调试最佳实践

1. **使用 contextIsolation**：
   在生产环境中启用 `contextIsolation` 并使用 `contextBridge` 安全地暴露 API[citation:6]：
   ```javascript
   // preload.js
   const { contextBridge, ipcRenderer } = require('electron')
   contextBridge.exposeInMainWorld('electronAPI', {
     sendMessage: (message) => ipcRenderer.send('message', message),
     onReply: (callback) => ipcRenderer.on('reply', callback)
   })
   ```

2. **日志记录**：
   使用 `console.log` 或专业日志库如 `winston` 记录关键信息

3. **测试框架**：
   - 单元测试：Jest、Mocha
   - E2E 测试：Spectron、Playwright

通过以上方法，你可以有效地调试 Electron 应用的主进程和渲染进程，确保应用的稳定性和性能。