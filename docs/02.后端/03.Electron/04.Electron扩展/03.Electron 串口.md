---
title: Electron 串口
date: 2025-10-27 14:58:27
permalink: /pages/a6a6de/
categories:
  - 后端
  - Electron
  - Electron扩展
tags:
  - 
---
## 背景
客户端需要和扫码枪进行通信，扫码枪通过串口和电脑进行通信，因此需要使用串口通信。

## serialport
使用的 serialport 库，可以参考 [serialport](https://github.com/serialport/node-serialport)。

因为 Node 版本比较久，使用的是 16，所以需要安装 16 版本的 serialport，可使用 9.x 和 10.x 版本。

## 安装
```bash
npm install serialport@9.2.8
```
需要注意，这个库需要进行编译

## 使用
```js
const SerialPort = require('serialport');

const path = '****';
let port;

// 检查串口是否打开
const checkPortExist = async (portPath: string) => {
  const ports = await SerialPort.list();
  return ports?.some(i => i?.path === portPath);
}

const isPortExist = await checkPortExist(portPath);

// 串口数据解析
const parseData = (data) => {
  const InterByteTimeout = require('@serialport/parser-inter-byte-timeout');
  const portInterByteTimeout = 100;

  const parser = port.pipe(
    new InterByteTimeout({ interval: portInterByteTimeout })
  ); // 1000毫秒未接到数据触发

  // 数据加载
  parser.on('data', (chunk: any) => {
    const value = chunk.toString('utf8');
    console.log('value', value);
  });
}

// 连接串口
const linkPort = (portPath, baudRate) => {
  const options = {
    baudRate: +baudRate,
    dataBits: 8, // 数据位
    parity: 'none', // 奇偶校验
    stopBits: 1, // 停止位
    autoOpen: false,
  };
  port = new SerialPort(path, options);

  // 打开串口
  port.open((err) => {
    if (err) {
      console.log('Error opening port: ', err.message);
    } else {
      console.log('Port opened');
    }
  });
}

if (isPortExist) {
  setTimeout(() => {
    linkPort(event, {portPath,baudRate});
  }, 10)
} else {
  // 串口不存在
}

// 关闭串口
const closePort = () => {
  if (port) {
    port.close((err) => {
      if (err) {
        console.log('Error closing port: ', err.message);
      } else {
        console.log('Port closed');
      }
    });
  }
}

// 发送数据
const sendData = (data) => {
  if (port) {
    port.write(data, (err) => {
      if (err) {
        console.log('Error writing to port: ', err.message);
      } else {
        console.log('Data sent to port');
      }
    });
  }
}

```

## 参考
- [serialport](https://github.com/serialport/node-serialport)