(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{557:function(s,a,t){"use strict";t.r(a);var e=t(8),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("p",[s._v("electron 客户端有串口相关业务，需要使用 "),a("a",{attrs:{href:"https://github.com/serialport/node-serialport",target:"_blank",rel:"noopener noreferrer"}},[s._v("node-searilport"),a("OutboundLink")],1),s._v(" 模块，该模块是 C++ 模块，需要经过编译才能在 js 环境中使用。然后根据网上的教程，一直没成功，真的是要砸键盘了，多次尝试后才成功，所以分享出来。")]),s._v(" "),a("h2",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),a("ul",[a("li",[s._v("system: win10 64")]),s._v(" "),a("li",[s._v("node: 16.19.0")]),s._v(" "),a("li",[s._v("npm: 8.18.0")]),s._v(" "),a("li",[s._v("electron：19.1.9")])]),s._v(" "),a("h2",{attrs:{id:"编译器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译器"}},[s._v("#")]),s._v(" 编译器")]),s._v(" "),a("p",[s._v("编译用到 node 模块 node-gyp,他的作用是编译 C++ 模块。\n直接安装就可以了")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("npm i node-gyp\n")])])]),a("h2",{attrs:{id:"c-开发环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#c-开发环境"}},[s._v("#")]),s._v(" C++ 开发环境")]),s._v(" "),a("p",[s._v("既然需要编译C++模块，那么C++环境必不可少。node-gyp 的相关文章中都推荐 "),a("code",[s._v("Windows-Build-Tools")]),s._v("，这个不管用，只能在老版本的 node-gyp 中使用，而且已经被原作者摒弃。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f6ba169203ff47da825e164a25666927~tplv-k3u1fbpfcp-watermark.image#?w=1797&h=681&s=100390&e=png&b=fff6f6",alt:"image.png"}})]),s._v(" "),a("p",[s._v("node-gyp 官网推荐 "),a("a",{attrs:{href:"https://my.visualstudio.com/Downloads?q=visual%20studio%202019&wt.mc_id=o~msft~vscom~older-downloads",target:"_blank",rel:"noopener noreferrer"}},[s._v("Visual Studio Build Tools"),a("OutboundLink")],1),s._v(", 这个工具需要跟你的系统以及node版本，electron版本相匹配，所以，选择 2019 版（此版本官网不提供下载，请使用"),a("a",{attrs:{href:"https://aka.ms/vs/16/release/vs_buildtools.exe",target:"_blank",rel:"noopener noreferrer"}},[s._v("2019版"),a("OutboundLink")],1),s._v("）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0fa52f0986b44108310ed1e89180e34~tplv-k3u1fbpfcp-watermark.image#?w=2118&h=1169&s=196661&e=png&b=f9f9f9",alt:"image.png"}}),s._v("\n安装过程中，选择 C++ 的桌面开发")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4dd538e9ca04d1680b2a9b33709381e~tplv-k3u1fbpfcp-watermark.image#?w=1920&h=1080&s=267434&e=png&b=fbfbfb",alt:"image.png"}})]),s._v(" "),a("p",[s._v("如果已经安装多个版本，可配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config get msvs_version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" msvs_version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"python-环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#python-环境"}},[s._v("#")]),s._v(" python 环境")]),s._v(" "),a("p",[s._v("node-gyp 封装了由 python 编写的 gyp 模块，所以 python 也需要安装。同样的，很多文章推荐使用 python 2.7，NO！这个也过时了，需要安装最新的 python 版本，3.11 或 3.10 都可以。")]),s._v(" "),a("p",[s._v("如果已经存在过往版本，可以通过配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" python python3.11\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"选择模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择模块"}},[s._v("#")]),s._v(" 选择模块")]),s._v(" "),a("p",[s._v("C++ 模块有对 node 和 electron 版本有要求，如 node-serailport，选择 10 版本以上的编译不通过，降级为 9.2.8 就可以")]),s._v(" "),a("h2",{attrs:{id:"编译-32-位或-64-位"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译-32-位或-64-位"}},[s._v("#")]),s._v(" 编译 32 位或 64 位")]),s._v(" "),a("p",[s._v("采用 electron-builder 进行编译时需要注意，在配置文件 "),a("code",[s._v("electron-builder.yaml")]),s._v(" 中，需要打开 "),a("code",[s._v("npmRebuild")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("npmRebuild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("确保切换 32 位或 64 位时，需要编译的包根据 arch 不同重新编译")])])}),[],!1,null,null,null);a.default=n.exports}}]);